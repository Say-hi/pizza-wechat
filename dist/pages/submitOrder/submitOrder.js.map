{"version":3,"sources":["pages/submitOrder/submitOrder.js"],"names":["app","getApp","Page","data","chooseAddress","that","wx","success","res","telNumber","setStorageSync","setData","needSetting","addressInfo","fail","getSetting","authSetting","setToast","content","openSetting","choosePay","showActionSheet","itemList","itemColor","lostTime","tapIndex","payMoney","orderId","payMoneyBywc","orderSubmit","removeStorageSync","calculateMoney","useCoupon","allMoney","dispatch_fee","balance","showLostTime","startTime","console","log","Date","getTime","toLocaleString","endTime","timer","setInterval","clearInterval","setTimeout","navigateBack","delta","lost","parseInt","timeText","getOrderDetail","oId","type","wxrequest","url","getUrl","detail","session3rd","gs","o_id","hideLoading","code","userName","name","phone","provinceName","address","menuArr","coupon_price","price","time","orderInfo","msg","orderdata","v","checked","push","s_id","id","num","orderBuy","cityName","countyName","detailInfo","cd_id","orderPay","showToast","title","redirectTo","pay","timeStamp","toString","errMsg","wxpay","onLoad","options","shop","money","sendTime","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"submitOrder.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {},\n  // 选择地址\n  chooseAddress () {\n    let that = this\n    wx.chooseAddress({\n      success (res) {\n        if (res.telNumber) { // 获取信息成功\n          wx.setStorageSync('addressInfo', res)\n          that.setData({\n            needSetting: false,\n            addressInfo: res\n          })\n        }\n      },\n      fail () {\n        wx.getSetting({\n          success (res) {\n            if (!res.authSetting['scope.address']) {\n              that.setData({\n                needSetting: true\n              })\n              app.setToast(that, {content: '需授权获取地址信息'})\n            }\n          }\n        })\n      }\n    })\n  },\n  // 获取设置\n  openSetting () {\n    let that = this\n    wx.openSetting({\n      success (res) {\n        // console.log(res)\n        if (res.authSetting['scope.address']) {\n          that.setData({\n            needSetting: false\n          })\n          that.chooseAddress()\n        }\n      }\n    })\n  },\n  // 选择支付方式\n  choosePay () {\n    if (!this.data.addressInfo) return app.setToast(this, {content: '请选择您的收货地址'})\n    let that = this\n    wx.showActionSheet({\n      itemList: ['余额支付', '微信支付'],\n      itemColor: '#333',\n      success (res) {\n        if (that.data.lostTime) {\n          if (res.tapIndex * 1 + 1 === 1) {\n            that.payMoney(that.data.orderId)\n          } else {\n            that.payMoneyBywc(that.data.orderId)\n          }\n        } else {\n          that.orderSubmit(res.tapIndex * 1 + 1)\n        }\n        wx.removeStorageSync('goodsStorage')\n        wx.removeStorageSync('useCoupon')\n      }\n    })\n  },\n  // 计算价格\n  calculateMoney () {\n    this.setData({\n      calculateMoney: this.data.useCoupon ? this.data.allMoney * 1 + this.data.dispatch_fee * 1 - this.data.useCoupon.balance : this.data.allMoney * 1 + this.data.dispatch_fee * 1\n    })\n  },\n  // 倒计时\n  showLostTime (startTime) {\n    console.log(new Date().getTime())\n    console.log(new Date(startTime * 1000).toLocaleString())\n    let endTime = startTime * 1000 + 900000 // 超时15分钟\n    let timer = setInterval(() => {\n      if (endTime - new Date().getTime() <= 0) {\n        // todo 取消订单\n        clearInterval(timer)\n        app.setToast(this, {content: '该订单超时支付已取消'})\n        setTimeout(() => {\n          wx.navigateBack({\n            delta: 1\n          })\n        }, 1500)\n        return\n      }\n      let lost = parseInt((endTime - (new Date().getTime())) / 1000)\n      // let m = parseInt(lost / 60)\n      // let s = lost % 60\n      this.setData({\n        timeText: parseInt(lost / 60) === 0 ? lost % 60 + '秒' : parseInt(lost / 60) + '分' + lost % 60 + '秒'\n      })\n    }, 100)\n  },\n  // 获取订单详情\n  getOrderDetail (oId, type) {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().detail,\n      data: {\n        session3rd: app.gs(),\n        o_id: oId\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.code === '200') {\n          let addressInfo = {\n            userName: res.data.data.name,\n            telNumber: res.data.data.phone,\n            provinceName: res.data.data.address\n          }\n          that.setData({\n            addressInfo,\n            menuArr: res.data.data.detail,\n            dispatch_fee: res.data.data.dispatch_fee,\n            coupon_price: res.data.data.coupon_price,\n            calculateMoney: res.data.data.price,\n            type,\n            /*eslint-disable*/\n            lostTime: type === 'second' ? true : false\n          })\n          that.showLostTime(res.data.data.time)\n          that.setData({\n            orderInfo: res.data.data\n          })\n        } else {\n          app.setToast(that, {content: res.data.msg})\n        }\n      }\n    })\n  },\n  // 提交订单\n  orderSubmit (type) {\n    let that = this\n    let orderdata = []\n    for (let v of this.data.menuArr) {\n      if (v.checked) {\n        orderdata.push({s_id: v.id || v.s_id, num: v.num})\n      }\n    }\n    app.wxrequest({\n      url: app.getUrl().orderBuy,\n      data: {\n        session3rd: app.gs(),\n        name: that.data.addressInfo.userName,\n        phone: that.data.addressInfo.telNumber,\n        address: that.data.addressInfo.provinceName + that.data.addressInfo.cityName + that.data.addressInfo.countyName + that.data.addressInfo.detailInfo,\n        data: orderdata,\n        cd_id: that.data.useCoupon ? that.data.useCoupon.cd_id : ''\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.code === '200') {\n          if (type === 2) {\n            that.payMoneyBywc(res.data.data)\n          } else {\n            that.payMoney(res.data.data)\n          }\n        } else {\n          app.setToast(that, {content: res.data.msg})\n        }\n      }\n    })\n  },\n  payMoney (id) {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().orderPay,\n      data: {\n        session3rd: app.gs(),\n        o_id: id\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.code === '200') {\n          wx.showToast({\n            title: '付款成功'\n          })\n          setTimeout(() => {\n            wx.navigateBack({\n              delta: 1\n            })\n          }, 1000)\n        } else {\n          app.setToast(that, {content: res.data.msg})\n          if (that.data.lostTime) return\n          setTimeout(() => {\n            wx.redirectTo({\n              url: `../submitOrder/submitOrder?id=${id}&type=second`\n            })\n          }, 1500)\n        }\n      }\n    })\n  },\n  payMoneyBywc (id) {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().pay,\n      data: {\n        session3rd: app.gs(),\n        o_id: id\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.code === '200') {\n          res.data.data.timeStamp = res.data.data.timeStamp.toString()\n          res.data.data.success = function (res) {\n            if (res.errMsg = 'requestPayment:ok') {\n              wx.showToast({\n                title: '付款成功'\n              })\n              setTimeout(() => {\n                wx.navigateBack({\n                  delta: 1\n                })\n              }, 1000)\n            } else {\n              app.setToast(that, {content: res.errMsg})\n              setTimeout(() => {\n                wx.redirectTo({\n                  url: `../submitOrder/submitOrder?id=${id}&type=second`\n                })\n              }, 1500)\n            }\n          }\n          res.data.data.fail = function () {\n            app.setToast(that, {content: '支付失败'})\n            setTimeout(() => {\n              wx.redirectTo({\n                url: `../submitOrder/submitOrder?id=${id}&type=second`\n              })\n            }, 1500)\n          }\n          app.wxpay(res.data.data)\n        } else {\n          app.setToast(that, {content: res.data.msg})\n        }\n      }\n    })\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (options) {\n    /*eslint-disable*/\n    if (options.type === 'second') {\n      this.getOrderDetail(options.id, options.type)\n    } else {\n      this.setData({\n        dispatch_fee: app.gs('shop').shop.dispatch_fee,\n        menuArr: app.gs('goodsStorage')\n      })\n    }\n    this.setData({\n      orderId: options.id,\n      allMoney: options.money || 0,\n      sendTime: new Date(new Date().getTime() + 1500000).toLocaleString()\n    })\n    if (options.time) {\n      this.showLostTime(options.time)\n    }\n    // this.calculateMoney()\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    if (app.gs('useCoupon')) {\n      this.setData({\n        useCoupon: app.gs('useCoupon')\n      })\n    }\n    if (app.gs('addressInfo') && !this.data.orderId) {\n      this.setData({\n        addressInfo: app.gs('addressInfo')\n      })\n    }\n    this.calculateMoney()\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    wx.removeStorageSync('useCoupon')\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}