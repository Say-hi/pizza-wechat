{"version":3,"sources":["pages/submitOrder/submitOrder.js"],"names":["app","getApp","Page","data","img","sendMoney","chooseAddress","that","wx","success","res","telNumber","setStorageSync","setData","needSetting","addressInfo","fail","getSetting","authSetting","setToast","content","openSetting","choosePay","showActionSheet","itemList","itemColor","console","log","tapIndex","showToast","title","redirectTo","url","removeStorageSync","calculateMoney","useCoupon","allMoney","del","showLostTime","startTime","endTime","Date","getTime","timer","setInterval","clearInterval","setTimeout","navigateBack","delta","lost","parseInt","timeText","onLoad","options","lostTime","type","menuArr","gs","sendTime","toLocaleString","money","time","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"submitOrder.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n    sendMoney: 20\n  },\n  // 选择地址\n  chooseAddress () {\n    let that = this\n    wx.chooseAddress({\n      success (res) {\n        if (res.telNumber) { // 获取信息成功\n          wx.setStorageSync('addressInfo', res)\n          that.setData({\n            needSetting: false,\n            addressInfo: res\n          })\n        }\n      },\n      fail () {\n        wx.getSetting({\n          success (res) {\n            if (!res.authSetting['scope.address']) {\n              that.setData({\n                needSetting: true\n              })\n              app.setToast(that, {content: '需授权获取地址信息'})\n            }\n          }\n        })\n      }\n    })\n  },\n  // 获取设置\n  openSetting () {\n    let that = this\n    wx.openSetting({\n      success (res) {\n        // console.log(res)\n        if (res.authSetting['scope.address']) {\n          that.setData({\n            needSetting: false\n          })\n          that.chooseAddress()\n        }\n      }\n    })\n  },\n  // 选择支付方式\n  choosePay () {\n    if (!this.data.addressInfo) return app.setToast(this, {content: '请选择您的收货地址'})\n    wx.showActionSheet({\n      itemList: ['微信支付', '余额支付'],\n      itemColor: '#333',\n      success (res) {\n        console.log(res.tapIndex)\n        wx.showToast({\n          title: '模拟支付成功'\n        })\n        wx.redirectTo({\n          url: '../order/order'\n        })\n        wx.removeStorageSync('goodsStorage')\n        wx.removeStorageSync('useCoupon')\n      }\n    })\n  },\n  // 计算价格\n  calculateMoney () {\n    this.setData({\n      calculateMoney: this.data.useCoupon ? this.data.allMoney * 1 + this.data.sendMoney * 1 - this.data.useCoupon.del : this.data.allMoney * 1 + this.data.sendMoney * 1\n    })\n  },\n  // 倒计时\n  showLostTime (startTime) {\n    let endTime = new Date(startTime).getTime() + 900000 // 超时15分钟\n    let timer = setInterval(() => {\n      if (endTime - new Date().getTime() <= 0) {\n        // todo 取消订单\n        clearInterval(timer)\n        app.setToast(this, {content: '该订单超时支付已取消'})\n        setTimeout(() => {\n          wx.navigateBack({\n            delta: 1\n          })\n        }, 1500)\n        return\n      }\n      let lost = parseInt((endTime - (new Date().getTime())) / 1000)\n      // let m = parseInt(lost / 60)\n      // let s = lost % 60\n      this.setData({\n        timeText: parseInt(lost / 60) === 0 ? lost % 60 + '秒' : parseInt(lost / 60) + '分' + lost % 60 + '秒'\n      })\n    }, 100)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (options) {\n    /*eslint-disable*/\n    // new Date(new Date().getTime() + 1500000)\n    this.setData({\n      lostTime: options.type === 'second' ? true : false,\n      menuArr: app.gs('goodsStorage'),\n      sendTime: new Date(new Date().getTime() + 1500000).toLocaleString(),\n      allMoney: options.money || 0\n    })\n    if (options.time) {\n      this.showLostTime(options.time)\n    }\n    // this.calculateMoney()\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    if (app.gs('useCoupon')) {\n      this.setData({\n        useCoupon: app.gs('useCoupon')\n      })\n    }\n    if (app.gs('addressInfo')) {\n      this.setData({\n        addressInfo: app.gs('addressInfo')\n      })\n    }\n    this.calculateMoney()\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    wx.removeStorageSync('useCoupon')\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}