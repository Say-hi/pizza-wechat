{"version":3,"sources":["pages/coupon/coupon.js"],"names":["app","getApp","Page","data","currentIndex","needUseCoupon","page","couponArr","getCouponData","status","that","wxrequest","url","getUrl","mycoupon","session3rd","gs","success","res","wx","hideLoading","code","v","start_time","Date","toLocaleDateString","end_time","setData","concat","more","length","setToast","content","msg","chooseTab","e","currentTarget","dataset","index","useCoupon","su","navigateBack","delta","onLoad","options","type","orderMoney","money","onReachBottom","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":";;AAAA;AACA,IAAMA,MAAMC,QAAZ;;AAEA;AACAC,KAAK;AACH;;;AAGAC,QAAM;AACJC,kBAAc,CADV;AAEJC,mBAAe,KAFX;AAGJC,UAAM,CAAC,CAHH;AAIJC,eAAW;AAJP,GAJH;AAUHC,eAVG,2BAUwB;AAAA,QAAZC,MAAY,uEAAH,CAAG;;AACzB,QAAIC,OAAO,IAAX;AACAV,QAAIW,SAAJ,CAAc;AACZC,WAAKZ,IAAIa,MAAJ,GAAaC,QADN;AAEZX,YAAM;AACJY,oBAAYf,IAAIgB,EAAJ,EADR;AAEJP,sBAFI;AAGJH,cAAM,EAAE,KAAKH,IAAL,CAAUG;AAHd,OAFM;AAOZW,aAPY,mBAOHC,GAPG,EAOE;AACZC,WAAGC,WAAH;AACA,YAAIF,IAAIf,IAAJ,CAASkB,IAAT,KAAkB,KAAtB,EAA6B;AAAA;AAAA;AAAA;;AAAA;AAC3B,iCAAcH,IAAIf,IAAJ,CAASA,IAAvB,8HAA6B;AAAA,kBAApBmB,CAAoB;;AAC3BA,gBAAEC,UAAF,GAAe,IAAIC,IAAJ,CAASF,EAAEC,UAAF,GAAe,IAAxB,EAA8BE,kBAA9B,EAAf;AACAH,gBAAEI,QAAF,GAAa,IAAIF,IAAJ,CAASF,EAAEI,QAAF,GAAa,IAAtB,EAA4BD,kBAA5B,EAAb;AACD;AAJ0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAK3Bf,eAAKiB,OAAL,CAAa;AACXpB,uBAAWG,KAAKP,IAAL,CAAUI,SAAV,CAAoBqB,MAApB,CAA2BV,IAAIf,IAAJ,CAASA,IAApC,CADA;AAEX0B,kBAAMX,IAAIf,IAAJ,CAASA,IAAT,CAAc2B,MAAd,GAAuB,EAAvB,GAA4B,CAA5B,GAAgC;AAF3B,WAAb;AAID,SATD,MASO;AACL9B,cAAI+B,QAAJ,CAAarB,IAAb,EAAmB,EAACsB,SAASd,IAAIf,IAAJ,CAAS8B,GAAnB,EAAnB;AACD;AACF;AArBW,KAAd;AAuBD,GAnCE;AAoCHC,WApCG,qBAoCQC,CApCR,EAoCW;AACZ,SAAKR,OAAL,CAAa;AACXvB,oBAAc+B,EAAEC,aAAF,CAAgBC,OAAhB,CAAwBC,KAD3B;AAEXhC,YAAM,CAAC,CAFI;AAGXC,iBAAW;AAHA,KAAb;AAKA,SAAKC,aAAL,CAAmB2B,EAAEC,aAAF,CAAgBC,OAAhB,CAAwBC,KAAxB,GAAgC,CAAhC,GAAoC,CAAvD;AACD,GA3CE;;AA4CH;AACAC,WA7CG,qBA6CQJ,CA7CR,EA6CW;AACZnC,QAAIwC,EAAJ,CAAO,WAAP,EAAoB,KAAKrC,IAAL,CAAUI,SAAV,CAAoB4B,EAAEC,aAAF,CAAgBC,OAAhB,CAAwBC,KAA5C,CAApB;AACAnB,OAAGsB,YAAH,CAAgB;AACdC,aAAO;AADO,KAAhB;AAGD,GAlDE;;AAmDH;;;AAGAC,QAtDG,kBAsDKC,OAtDL,EAsDc;AACf;AACA,SAAKjB,OAAL,CAAa;AACXtB,qBAAeuC,QAAQC,IAAR,KAAiB,OAAjB,GAA2B,IAA3B,GAAkC,KADtC;AAEXC,kBAAYF,QAAQG,KAAR,IAAiB;AAFlB,KAAb;AAIA,SAAKvC,aAAL;AACA;AACD,GA9DE;AA+DHwC,eA/DG,2BA+Dc;AACf,QAAI,CAAC,KAAK7C,IAAL,CAAU0B,IAAf,EAAqB,OAAO7B,IAAI+B,QAAJ,CAAa,IAAb,EAAmB,EAACC,SAAS,YAAV,EAAnB,CAAP;AACrB,SAAKxB,aAAL,CAAmB,KAAKL,IAAL,CAAUC,YAAV,GAAyB,CAAzB,GAA6B,CAAhD;AACD,GAlEE;;AAmEH;;;AAGA6C,SAtEG,qBAsEQ;AACT;AACD,GAxEE;;;AA0EH;;;AAGAC,QA7EG,oBA6EO;AACR;AACD,GA/EE;;;AAiFH;;;AAGAC,QApFG,oBAoFO;AACR;AACD,GAtFE;;;AAwFH;;;AAGAC,UA3FG,sBA2FS;AACV;AACD,GA7FE;;;AA+FH;;;AAGAC,mBAlGG,+BAkGkB;AACnB;AACD;AApGE,CAAL","file":"coupon.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    currentIndex: 0,\n    needUseCoupon: false,\n    page: -1,\n    couponArr: []\n  },\n  getCouponData (status = 1) {\n    let that = this\n    app.wxrequest({\n      url: app.getUrl().mycoupon,\n      data: {\n        session3rd: app.gs(),\n        status,\n        page: ++this.data.page\n      },\n      success (res) {\n        wx.hideLoading()\n        if (res.data.code === '200') {\n          for (let v of res.data.data) {\n            v.start_time = new Date(v.start_time * 1000).toLocaleDateString()\n            v.end_time = new Date(v.end_time * 1000).toLocaleDateString()\n          }\n          that.setData({\n            couponArr: that.data.couponArr.concat(res.data.data),\n            more: res.data.data.length < 10 ? 0 : 1\n          })\n        } else {\n          app.setToast(that, {content: res.data.msg})\n        }\n      }\n    })\n  },\n  chooseTab (e) {\n    this.setData({\n      currentIndex: e.currentTarget.dataset.index,\n      page: -1,\n      couponArr: []\n    })\n    this.getCouponData(e.currentTarget.dataset.index * 1 + 1)\n  },\n  // 使用优惠卷\n  useCoupon (e) {\n    app.su('useCoupon', this.data.couponArr[e.currentTarget.dataset.index])\n    wx.navigateBack({\n      delta: 1\n    })\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (options) {\n    /*eslint-disable*/\n    this.setData({\n      needUseCoupon: options.type === 'order' ? true : false,\n      orderMoney: options.money || 0\n    })\n    this.getCouponData()\n    // TODO: onLoad\n  },\n  onReachBottom () {\n    if (!this.data.more) return app.setToast(this, {content: '您没有更多的优惠卷啦'})\n    this.getCouponData(this.data.currentIndex * 1 + 1)\n  },\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}